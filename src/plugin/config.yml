## Plugin Configuration
---
package:
    author: KBase Developer
    name: catalog
    description: The catalog panel and associated widgets
source:
    ## sources are relative to build/plugins/PACKAGE/source/javascript
    ## NB: need to quote file names, otherwise
    modules:
    styles:
        # - file: styles.css
install:
    widgets:
        - module: ./panel
          id: kb_plugin_catalog
          type: es6
    routes:
        # Catalog Index
        # The catalog index is the view which lists additional catalog tools.
        - path: ['catalog', { type: literal, name: index, optional: true }]
          params:
              view: catalogIndex
          widget: kb_plugin_catalog

        # plain catalog/apps goes to the app browser
        - path: ['catalog', 'apps', { type: param, name: tag, optional: true }]
          params:
              view: appsBrowser
          widget: kb_plugin_catalog

        # App View
        # catalog/apps/NAMESPACE/ID and
        # catalog/apps/NAMESPACE/ID/TAG
        # lead to the app viewer
        - path:
              [
                  'catalog',
                  'apps',
                  { type: param, name: namespace },
                  { type: param, name: id },
                  { type: param, name: tag, optional: true },
              ]
          params:
              view: appView
          widget: kb_plugin_catalog

        # Module Browser and View
        - path: ['catalog', 'modules']
          params:
              view: moduleBrowser
          widget: kb_plugin_catalog
        - path: ['catalog', 'modules', { type: param, name: module_name }]
          param:
              view: moduleView
          widget: kb_plugin_catalog

        # Dynamic Services Catalog
        - path: ['catalog', 'services']
          params:
              view: serviceCatalog
          widget: kb_plugin_catalog

        # Functions browser and view
        - path: ['catalog', 'functions', { type: param, name: tag, optional: true }]
          params:
              view: functionBrowser
          widget: kb_plugin_catalog
        - path:
              [
                  'catalog',
                  'functions',
                  { type: param, name: module },
                  { type: param, name: function_id },
                  { type: param, name: ver, optional: true },
              ]
          params:
              view: functionView
          widget: kb_plugin_catalog

        # Data Types Browser
        - path: ['catalog', 'datatypes']
          queryParams:
              path: { literal: ['datatypeBrowser'] }
          widget: kb_plugin_catalog

        # Developer Tools

        # Registration view

        # TODO: make sure it works.
        - path: ['catalog', 'register', { type: param, name: registration_id }]
          queryParams:
              path: { literal: ['catalogRegistration'] }
          widget: kb_plugin_catalog
        - path: ['catalog', 'stats']
          queryParams:
              path: { literal: ['catalogStats'] }
          widget: kb_plugin_catalog
        - path: ['catalog', 'status', { type: param, name: module_names, optional: true }]
          queryParams:
              path: { literal: ['catalogStatus'] }
          widget: kb_plugin_catalog
        - path: ['catalog', 'admin']
          queryParams:
              path: { literal: ['catalogAdmin'] }
          widget: kb_plugin_catalog
        - path: ['catalog', 'queue']
          queryParams:
              path: { literal: ['catalogQueue'] }
          widget: kb_plugin_catalog

        # OLD ROUTES
        # Todo: do we still need these?
        # For now, let's just keep the root appcatalog. The rest of the routes
        # (see the old config.yml) are duplicates of most of the above, and i would bet
        # that the vast majority of links to them are generated right here in this
        # plugin. In other words
        #
        # App Browser
        # The normal user "home page" for the catalog is the app browser
        - path:
              [
                  'appcatalog',
                  { type: literal, name: browse, optional: true },
                  { type: param, name: tag, optional: true },
              ]
          queryParams:
              path: { literal: ['appsBrowser'] }
          widget: kb_plugin_catalog

    menu:
        - name: catalog
          definition:
              path: ['catalog', 'apps']
              label: Catalog
              icon: book
